-[SetTitle"MMExtension"]
en|MMExtension is a rich modding environment for MM6-8. It features a level editor, uses Lua 
scripting language, lets you use all commands of internal M&amp;M scripts language (<b>evt</b> commands) and
lets you do a lot of other things. In future it can be extended with commands modders need. Note that on first two launches there is a long delay due to Data\Tables generation.|
ru|MMExtension - это мощное расширение MM6-8 для моддинга, с редактором уровней. Оно 
использует скрипты на Lua, позволяет вызывать все команды внутреннего 
языка скриптов M&amp;M (команды <b>evt</b>) и позволяет делать многое 
другое. В будущем он может быть дополнен командами, нужными для моддеров. Не пугайтесь задержки при первых двух запусках - она вызвана генерацией Data\Tables.|
<br>
<br>
<a href="https://dl.dropboxusercontent.com/u/44735333/mm/MMExtension.rar">en|Download|ru|Скачать| MMExtension</a><br>
<a href="https://dl.dropboxusercontent.com/u/44735333/mm/MMExtensionSrc.rar">en|Download MMExtension DLLs source code|ru|Скачать исходники библиотек MMExtension|</a><br>
<br>
<a href="https://dl.dropboxusercontent.com/u/44735333/mm/MMEditor.rar">en|Download|ru|Скачать| MMEditor v2.1</a><br>
en|Fully-featured level editor|ru|Полноценный редактор уровней|. <a href="https://dl.dropboxusercontent.com/u/44735333/mm/MMEditorDlgSrc.rar">en|(MMEditorDlg.dll source code, Delphi 2006)|ru|(исходники MMEditorDlg.dll, Delphi 2006)|</a><br>
<div>
<div>
<br>
<a href="https://sites.google.com/site/sergroj/mm/mmextension/SoloGame.rar?attredirects=0">en|Download Solo Game script for MM7/MM8|ru|Скачать скрипт для игры соло в MM6/MM7|</a><br>
en|A very basic solo game support script for MM6/MM7. Unpack this script into game folder, run the game, press Ctrl+F1, write "vars.PartySize = 1" and press Ctrl+Enter. This will make you play solo. To play with 2 or 3 persons write "vars.PartySize = 2" or "vars.PartySize = 3" correspondingly. |
ru|Очень примитивный скрипт для игры одним игроком в MM6/MM7. Распакуйте в папку игры, запустите игру, нажмите Ctrl+F1, напишите "vars.PartySize = 1" и нажмите Ctrl+Enter. Это приведет к тому, что Вы будете играть одним игроком. Чтобы играть двумя или тремя, напишите "vars.PartySize = 2" или "vars.PartySize = 3" соответственно. |
<br>
<br>
<a href="https://dl.dropboxusercontent.com/u/44735333/mm/MM6Scripts.rar">en|Download MM6 decompiled scripts|ru|Скачать докомпилированные скрипты MM6|</a><br>

<a href="https://dl.dropboxusercontent.com/u/44735333/mm/MM7Scripts.rar">en|Download MM7 decompiled scripts|ru|Скачать докомпилированные скрипты MM7|</a><br>

<a href="https://dl.dropboxusercontent.com/u/44735333/mm/MM8Scripts.rar">en|Download MM8 decompiled scripts|ru|Скачать докомпилированные скрипты MM8|</a><br>
en|Use decompiled scripts as an example of Evt commands usage.|ru|Используйте декомпилированные скрипты как пример использования команд Evt.|
<br>
<br>
</div>
<div><a href="http://www.celestialheavens.com/forums/viewtopic.php?t=10423">en|Discussion|ru|Обсуждение|</a><br>
</div>
<div>en|A topic for MMExtension discussion.|ru|Тема для обсуждения MMExtension на английском.|<br>
</div>
<div><br>
en|Below is a small Help for MMExtension. Make sure you look at example quests. You can find more examples in the discussion thread (linked just above).|
ru|Ниже находится Помощь для MMExtension. Обязательно посмотрите примеры заданий. Больше примеров можно найти в теме на Celestial Heavens (см. чуть выше).|
<br>
<br>
<img src="https://www.google.com/chart?chc=sites&amp;cht=d&amp;chdp=sites&amp;chl=%5B%5B%D0%9E%D0%B3%D0%BB%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5%27%3D20%27f%5Cv%27a%5C%3D0%2710%27%3D399%270%27dim%27%5Cbox1%27b%5CF6F6F6%27fC%5CF6F6F6%27eC%5C0%27sk%27%5C%5B%27%5D%27a%5CV%5C%3D12%27f%5C%5DV%5Cta%5C%3D10%27%3D0%27%3D400%27%3D297%27dim%27%5C%3D10%27%3D10%27%3D400%27%3D297%27vdim%27%5Cbox1%27b%5Cva%5CF6F6F6%27fC%5CC8C8C8%27eC%5C%27a%5C%5Do%5CLauto%27f%5C&amp;sig=RtCrfvnQmzp1ov-JZ9vFQ0cEkec" data-type="toc" data-props="align:left;maxDepth:6;width:400;" style="display:block;text-align:left;margin-right:auto;" height="300" width="400">



<br>
<h2>en|General Information|ru|Общая информация|</h2>
en|You will need|ru|Для моддинга Вам понадобятся| <a href="https://sites.google.com/site/sergroj/mm/MMArchive.rar?attredirects=0">MMArchive</a>, <a href="http://sourceforge.net/projects/mm8leveleditor/files/MM8LevelEditor/">mm8leveleditor</a> en|and|ru|и| <a href="http://sites.google.com/site/angelddeath/#TOC-Might-Magic-6-8-Map-Viewer">MM Map Viewer</a>.
<br>
en|Extract all *.txt files from appropriate LOD archive:
icons.lod in MM6, events.lod in MM7 or EnglishT.lod in MM8. You will need them.|
ru|Извлеките все файлы *.txt из соответствующих архивов LOD: icons.lod в MM6, events.lod в MM7 или EnglishT.lod в MM8. Вам они понадобятся.|
<br>
en|Easiest thing to start with is editing text tables with|ru|Проще всего начать с редактирования текстовых таблиц с помощью| <a href="https://sites.google.com/site/sergroj/wog/TxtEdit.rar?attredirects=0">TxtEdit</a>.
en|In addition to *.txt files that you've extracted from LOD archives MMExtension will create some tables in Data\Tables folder on first launch. You can change any values in them and add new lines to many of them.|
ru|В добавок к файлам *.txt, которые Вы извлекли из LOD-архива MMExtension создаст некоторые таблицы в папке Data\Tables при первом запуске. Вы можете менять в них любые значения и добавлять новые строки ко многим из них.|
<br>
<br>

en|<b>Lua</b> is a simple, yet powerful scripting language. You can read about it <a href="http://www.lua.org/manual/5.1/">here</a>,
<a href="http://www.lua.org/pil/">here</a> and <a href="http://luajit.org/extensions.html">here</a>. MMExtension exposes all standard Lua and LuaJIT libraries.<br>
I used to use SciTE to edit Lua scripts. Here are some of my settings in it:|
ru|<b>Lua</b> - это простой, но гибкий скриптовый язык. Вы можете прочитать о нём <a href="http://www.lua.org/manual/5.1/">здесь</a>, <a href="http://www.lua.org/pil/">здесь</a> и <a href="http://luajit.org/extensions.html">здесь</a>. MMExtension предоставляет все стандартные библиотеки Lua и LuaJIT.<br>
Раньше я использовал SciTE для редактирования скриптов Lua. Вот некоторые мои настройки для него:|
<table style="margin:6px 0;border-color:rgb(136,136,136);border-width:1px;border-collapse:collapse" border="1" bordercolor="#888888" cellpadding="5" cellspacing="0">
<tbody>
<tr>
<td>
en|Open|ru|Откройте| SciTEGlobal.properties.<br>
<br>
<b>en|Find and set up these settings:|ru|Найдите и установите следующие параметры:|</b><br>
tabsize=2<br>
indent.size=2<br>
braces.autoclose=0<br>
<br>
<b>en|Find|ru|Найдите|</b> user.shortcuts=\<br>
<b>en|delete line with|ru|удалите строку с|</b> Alt+X<br>
<b>en|add line|ru|добавьте строку|:</b> Ctrl+Shift+Z||IDM_REDO||\<br>
<b>en|add line|ru|добавьте строку|:</b> Ctrl+R||IDM_REPLACE||\<br>
</td>
</tr>
</tbody>
</table>
<br>
en|All scripts are located in Scripts directory. Subfolders determine when scripts get loaded and unloaded:|
ru|Все скрипты находятся в директории Scripts. Скрипты в разных подпапках загружаются и выгружаются в разные моменты:|
<br>
<table style="margin:6px 0;border-color:rgb(136,136,136);border-width:1px;border-collapse:collapse" border="1" bordercolor="#888888" cellpadding="2" cellspacing="0" width="70%">
<tbody>
<tr>
<td><i>&nbsp;en|Subfolder|ru|Подпапка|
</i></td>
<td><i>&nbsp;en|Description|ru|Описание|
</i></td>
</tr>
<tr>
<td>Core</td>
<td>en|MMExtension core scripts. Don't put your scripts here.|ru|Скрипты ядра MMExtension. Не кладите сюда свои скрипты.|
</td>
</tr>
<tr>
<td>General</td>
<td>en|These scripts are loaded before the game starts and are never unloaded.|
ru|Эти скрипты загружаются перед началом игры и никогда не выгружается.|
</td>
</tr>
<tr>
<td>Global</td>
<td>en|These scripts are loaded when a new game is started or a saved game is loaded and are unloaded
when user exits to main menu or loads another game. This is a good place for most of your scripts that don't belong to specific maps. Quests scripts in particular.|
ru|Эти скрипты загружаются, когда запускается новая игра или загружается сохраненная игра, и выгружается
когда пользователь выходит в главное меню или загружает другую игру. Это хорошее место для большинства скриптов, которые не относятся к конкретной карте. В частности, для скриптов заданий.|
</td>
</tr>
<td>Localization</td>
<td>en|These scripts and text files are loaded on game start just before "General" scripts and can be reloaded with <b>ReloadLocalization()</b> function. They should be used for mods localization.|
ru|Эти скрипты загружаются при старте игры перед загрузкой скриптов из папки "General" и могут быть загружены снова вызовом функции <b>ReloadLocalization()</b>. Они предназначены для локализации модов.|
</td>
</tr>
<tr>
<td>Maps</td>
<td>en|These scripts correspond to maps. For example, scripts named "oute3.lua" and "some_name.oute3.lua" would be loaded when
"oute3.odm" map (New Sorpigal) is loaded and unloaded when it is left.|
ru|Эти скрипты соответствуют картам.Например, скрипты под названием "oute3.lua" и "любое_имя.oute3.lua" будет загружаться при
загрузке карты "Oute3.odm" (Нью-Sorpigal) и выгружаться при выходе из неё.|
</td>
</tr>
<td>Modules</td>
<td>en|These scripts aren't loaded automatically. Instead they can be loaded with <b>require()</b> function.|
ru|Эти скрипты не загружаются автоматически. Вместо этого, их можно загружать при помощи функции <b>require()</b>.|
</td>
</tr>
<tr>
<td>Structs</td>
<td>en|These scripts are intended for structs definitions. These things are low-level, so I won't describe them yet.
If you find some interesting address with ArtMoney or disassembler, ask me.|
ru|Эти скрипты предназначены для определения структур. Эти вещи низкого уровня, так что пока я не буду описывать их.
Если вы нашли интересный адрес с помощью ArtMoney или дизассемблера, спросите меня.|
</td>
</tr>
<tr>
<td colspan="2">en|You can create your own subfolders. Scripts in them won't be loaded automatically and
won't be unloaded either.|
ru|Вы можете создавать свои собственные подпапки. Скрипты в них не будут загружаться автоматически и не будет выгружаться.|
<br>
<br>
en|The word 'unload' means removing all events of a script. As a consequence of global and maps scripts
being unloaded and then loaded again, you can change them and test changes by simply reloading a saved game.
No need to exit Might and Magic for this.|
ru|Слово "выгружать" означает удаление всех событий скрипта.В результате глобальные скрипты и скрипты карт выгружаются, а затем загружаются снова, вы можете их изменить и протестировать изменения, просто перезагрузив сохраненную игру.
Не нужно для этого выходить из игры Меч и Магия.|
<br>
</td>
</tr>
</tbody>
</table>
<br>
en|<b>Debug console</b> is a convenient way to quickly test things. Press Ctrl+F1 to open it.
You can write any script here. For example, <b>dump(Party[0].Stats)</b> would output first player's stats.<br>
Press Ctrl+Enter to execute a script.<br>
Press Ctrl+E to repeat the last script.<br>
Press Esc to cancel debug console.<br>|
ru|<b>Отладочная консоль</b> - это удобный способ быстро проверить что-нибудь. Нажмите Ctrl + F1, чтобы открыть её.
Здесь Вы можете писать любые скрипты. Например, <b>dump(Party[0].Stats)</b> выведет значения характеристик первого персонажа.<br>
Нажмите Ctrl + Enter, чтобы выполнить скрипт.<br>
Нажмите Ctrl + E, чтобы повторить последний скрипт.<br>
Нажмите Esc, чтобы закрыть консоль.<br>|
<br>
en|<b>Variables</b> used by your scripts can be of 4 types:<br>
Local variables, declared with the word <b>local</b> in Lua.
They can be used in the place where they were declared (i.e. function, script) and aren't stored is saved games.<br>
Global variables. They can be accessed from anywhere, but aren't stored in saved games.<br>
Variables in <b>Vars</b> table. They can be accessed from anywhere and are stored in savegames.<br>
Variables in <b>MapVars</b> table. They belong to current map. When a new map is entered
the appropriate variables table is set as <b>MapVars</b> table. They are stored in savegames.<br>|

ru|<b>Переменные</b>, используемые скриптами, могут быть 4 типов:<br>
Локальные переменные, объявленные со словом <b>local</b> в Lua.
Они могут быть использованы в месте, где они были объявлены (т.е. функции, скрипты) и хранятся не в сохранении игры.<br>
Глобальные переменные. Они могут быть доступны из любого места, но они не хранятся в сохранении игры.<br>
Переменные в таблице <b>Vars</b>. Они могут быть доступны из любого места и хранятся в сохранении игры<br>
Переменные в таблице <b>MapVars</b>. Они относятся к текущей карте. При загрузке карты, 
соответствующая таблица с переменными устанавливается, как <b>MapVars</b>. Они хранятся в сохранении игры.<br>|
<br>

<h3>en|Hello world!|ru|Привет мир!|</h3>
en|To make your first script create <b>out01.lua</b> file (or <b>oute3.lua</b> for MM6) in <b>Scripts\Maps</b> directory and write this text there:<br>|
ru|Для того, чтобы сделать первый скрипт, создайте файл <b>out01.lua</b> (или <b>oute3.lua</b> для MM6) в каталоге <b>Scripts\Maps</b> и напишите в нём этот текст:<br>|
<table style="margin:6px 0;border-color:rgb(136,136,136);border-width:1px;border-collapse:collapse" border="1" bordercolor="#888888" cellpadding="5" cellspacing="0">
<tbody>
<tr>
<td>
<pre style="white-space: pre-wrap;"><b><font color="Black">function</font></b> events.LoadMap()<br>  Message(<font color="Brown">"Hello world!"</font>)<br><b><font color="Black">end</font></b>
</pre>
</td>
</tr>
</tbody>
</table>
en|This script will show a message box each time you enter the first map.<br>
To show native MM message you can use a script like this:|
ru|Этот скрипт будет показывать окно сообщения каждый раз при входе в первую карту.<br>
Чтобы показать родное сообщение МM, вы можете использовать подобный скрипт:|
<table style="margin:6px 0;border-color:rgb(136,136,136);border-width:1px;border-collapse:collapse" border="1" bordercolor="#888888" cellpadding="5" cellspacing="0">
<tbody>
<tr>
<td>
<pre style="white-space: pre-wrap;"><B><font color="Blue">local</font></B> <B><font color="Black">function</font></B> HelloWorld()
  SimpleMessage(<font color="Brown">&quot;Hello world!&quot;</font>)
  RemoveTimer(HelloWorld)
<B><font color="Black">end</font></B>

Timer(HelloWorld, <font color="Brown">50</font>, <font color="Brown">true</font>)
</pre>
</td>
</tr>
</tbody>
</table>
en|I had to set up a timer, because Might and Magic doesn't support showing simple messages when the map is just loaded.<br>|
ru|Мне пришлось создать таймер, потому что Меч и Магия не поддерживает показ простых сообщений в момент загрузки карты.<br>|
<br>



<h3>en|Decompiled Scripts|ru|Декомпилированные скрипты|</h3>
en|Original Might and Magic scripts are stored in binary format in files with extension ".evt". MMExtension can decompile these scripts.
At the top of the page you've seen download links for decompiled scripts of original games.<br>
Decompiled scripts are in pseudo-code. Most commands used in them correspond to commands available for MMExtension,
as described in Evt section.<br>
Below are differences between them and real MMExtension commands:<br>
1) "evt." isn't written in them.<br>
2) They use jumps instead of if-then and loops. They have their lines numbered.<br>
3) They almost always supply parameter names in calls to Evt functions. You can do the same, but you can also use calls without parameter names.<br>
4) Some commands are are replaced by better analogs in MMExtension.
For example, you cannot use evt.OnTimer command, instead you should use Timer function.<br>
5) There other differences in syntax of scripts, like definition of events.<br>|

ru|Оригинальные скрипты Меча и Магии хранятся в двоичном формате в файлах с расширением ".evt".MMExtension может декомпилировать эти скрипты.
В верхней части этой страницы располагаются ссылки для скачивания декомпилированных скриптов оригинальной игры.<br>
Декомпилированные скрипты написаны в псевдокоде. Большинство команд, используемых в них, аналогичны командам, доступным в MMExtension, как описано в разделе Evt.<br>
Ниже приведены различия между ними и реальными командами MMExtension:<br>
1) "evt." в них не пишется.<br>
2) Они используют goto, а не структурные условные операторы и циклы. Их строки пронумерованы.<br>
3) Они почти всегда проставляют имена параметров в вызовах функций Evt. Вы можете сделать то же самое, но вы также можете использовать вызовы без имен параметров.<br>
Некоторые команды заменены лучшими аналогами в MMExtension. Например, вы не можете использовать команду evt.OnTimer, вместо этого вы должны использовать функцию Timer.<br>
5) Есть и другие отличия в синтаксисе скриптов - например, определение событий.<br>|

<br>
en|Here's an example|ru|Пример|:
<br>
<table style="margin:6px 0;border-color:rgb(136,136,136);border-width:1px;border-collapse:collapse" border="1" bordercolor="#888888" cellpadding="5" cellspacing="0">
<tbody>
<tr>
<td>
<pre style="white-space: pre-wrap;"><b>event</b> <font color="Brown">101</font>
  <font color="Brown">0</font>:  Cmp  <B><font color="Black">{</font></B><font color="Brown">&quot;QBits&quot;</font>, Value <B><font color="Blue">=</font></B> <font color="Brown">300</font>,   jump <B><font color="Blue">=</font></B> <font color="Brown">7</font><B><font color="Black">}</font></B>
  <font color="Brown">1</font>:  Player <B><font color="Blue">=</font></B> Players.all
  <font color="Brown">2</font>:  Cmp  <B><font color="Black">{</font></B><font color="Brown">&quot;Inventory&quot;</font>, Value <B><font color="Blue">=</font></B> <font color="Brown">489</font>,   jump <B><font color="Blue">=</font></B> <font color="Brown">5</font><B><font color="Black">}</font></B>  <font color="Green">-- &quot;Key to Goblinwatch&quot;</font>
  <font color="Brown">3</font>:  StatusText  <B><font color="Black">{</font></B>Str <B><font color="Blue">=</font></B> <font color="Brown">18</font><B><font color="Black">}</font></B>  <font color="Green">-- &quot;The door is locked.&quot;</font>
  <font color="Brown">4</font>:  Exit  <B><font color="Black">{</font></B><B><font color="Black">}</font></B>

  <font color="Brown">5</font>:  Subtract  <B><font color="Black">{</font></B><font color="Brown">&quot;Inventory&quot;</font>, Value <B><font color="Blue">=</font></B> <font color="Brown">489</font><B><font color="Black">}</font></B>  <font color="Green">-- &quot;Key to Goblinwatch&quot;</font>
  <font color="Brown">6</font>:  Set  <B><font color="Black">{</font></B><font color="Brown">&quot;QBits&quot;</font>, Value <B><font color="Blue">=</font></B> <font color="Brown">300</font><B><font color="Black">}</font></B>
  <font color="Brown">7</font>:  MoveToMap  <B><font color="Black">{</font></B>X <B><font color="Blue">=</font></B> <font color="Brown">601</font>, Y <B><font color="Blue">=</font></B> <font color="Brown">6871</font>, Z <B><font color="Blue">=</font></B> <font color="Brown">177</font>, Direction <B><font color="Blue">=</font></B> <font color="Brown">1400</font>, LookAngle <B><font color="Blue">=</font></B> <font color="Brown">0</font>, SpeedZ <B><font color="Blue">=</font></B> <font color="Brown">0</font>, HouseId <B><font color="Blue">=</font></B> <font color="Brown">171</font>, Icon <B><font color="Blue">=</font></B> <font color="Brown">5</font>, Name <B><font color="Blue">=</font></B> <font color="Brown">&quot;D01.blv&quot;</font><B><font color="Black">}</font></B>  <font color="Green">-- &quot;Goblinwatch&quot;</font>
  <font color="Brown">8</font>:  Exit  <B><font color="Black">{</font></B><B><font color="Black">}</font></B>

  <font color="Brown">9</font>:  EnterHouse  <B><font color="Black">{</font></B>Id <B><font color="Blue">=</font></B> <font color="Brown">171</font><B><font color="Black">}</font></B>  <font color="Green">-- &quot;Goblinwatch&quot;</font>
<B><font color="Black">end</font></B>
</pre>
</td>
</tr>
</tbody>
</table>
<br>
en|It may look like this as MMExtension script:|ru|Как скрипт MMExtension он может выглядеть так:|
<br>

<table style="margin:6px 0;border-color:rgb(136,136,136);border-width:1px;border-collapse:collapse" border="1" bordercolor="#888888" cellpadding="5" cellspacing="0">
<tbody>
<tr>
<td>
<pre style="white-space: pre-wrap;">Game.MapEvtLines:RemoveEvent(<font color="Brown">101</font>)  <font color="Green">-- remove original event</font>
evt.house[<font color="Brown">101</font>] <B><font color="Blue">=</font></B> <font color="Brown">171</font>  <font color="Green">-- name of this house is &quot;Goblinwatch&quot; and it will be used as hint. EnterHouse command in the end of decompiled script has the same meaning.</font>
evt.map[<font color="Brown">101</font>] <B><font color="Blue">=</font></B> <B><font color="Black">function</font></B>()
  <B><font color="Black">if</font></B> <B><font color="Black">not</font></B> evt.Cmp(<font color="Brown">&quot;QBits&quot;</font>, <font color="Brown">300</font>) <B><font color="Black">then</font></B>
    evt.Player <B><font color="Blue">=</font></B> evt.Players.All
    <B><font color="Black">if</font></B> <B><font color="Black">not</font></B> evt.Cmp(<font color="Brown">&quot;Inventory&quot;</font>, <font color="Brown">489</font>) <B><font color="Black">then</font></B>  <font color="Green">-- &quot;Key to Goblinwatch&quot;</font>
      <B><font color="Blue">return</font></B> evt.StatusText(<font color="Brown">18</font>)  <font color="Green">-- &quot;The door is locked.&quot;</font>
    <B><font color="Black">end</font></B>
    evt.Subtract(<font color="Brown">&quot;Inventory&quot;</font>, <font color="Brown">489</font>)  <font color="Green">-- &quot;Key to Goblinwatch&quot;</font>
    evt.Set(<font color="Brown">&quot;QBits&quot;</font>, <font color="Brown">300</font>)
  <B><font color="Black">end</font></B>
  evt.MoveToMap<B><font color="Black">{</font></B>X <B><font color="Blue">=</font></B> <font color="Brown">601</font>, Y <B><font color="Blue">=</font></B> <font color="Brown">6871</font>, Z <B><font color="Blue">=</font></B> <font color="Brown">177</font>, Direction <B><font color="Blue">=</font></B> <font color="Brown">1400</font>, LookAngle <B><font color="Blue">=</font></B> <font color="Brown">0</font>, SpeedZ <B><font color="Blue">=</font></B> <font color="Brown">0</font>, HouseId <B><font color="Blue">=</font></B> <font color="Brown">171</font>, Icon <B><font color="Blue">=</font></B> <font color="Brown">5</font>, Name <B><font color="Blue">=</font></B> <font color="Brown">&quot;D01.blv&quot;</font><B><font color="Black">}</font></B>  <font color="Green">-- &quot;Goblinwatch&quot;</font>
<B><font color="Black">end</font></B>
</pre>
</td>
</tr>
</tbody>
</table>
<br>
en|Notice that for commands Cmp, Set, Add and Subtract the first parameter is written without parameter name
even in decompiled scripts.
 This is done to improve readability.
 You can do the same tick with any command in your scripts.|
ru|Обратите внимание, что для команды Cmp, Set, Add и Subtract первый параметр записывается без имени даже в декомпилированных скриптах.
 Это сделано для улучшения читабельности.
 Вы можете так же сделать с любой командой в ваших скриптах.|<br>
<br>
en|That was a straight-forward conversion. Now it's time for a script doing the same thing (if you play the game from start with it), but written using MMExtension features:|
ru|Это была прямая конвертация скрипта. Если же использовать возможности MMExtension, то скрипт, делающий то же самое (если играть с ним с самого начала игры), будет выглядеть так:|
<br>


<a name="LocalizeScriptExample"></a>
<table style="margin:6px 0;border-color:rgb(136,136,136);border-width:1px;border-collapse:collapse" border="1" bordercolor="#888888" cellpadding="5" cellspacing="0">
<tbody>
<tr>
<td>
<pre style="white-space: pre-wrap;"><B><font color="Blue">local</font></B> TXT <B><font color="Blue">=</font></B> Localize<B><font color="Black">{</font></B>
  DoorIsLocked <B><font color="Blue">=</font></B> <font color="Brown">&quot;The door is locked.&quot;</font>
<B><font color="Black">}</font></B>
Game.MapEvtLines:RemoveEvent(<font color="Brown">101</font>)  <font color="Green">-- remove original event</font>
evt.house[<font color="Brown">101</font>] <B><font color="Blue">=</font></B> <font color="Brown">171</font>  <font color="Green">-- name of this house is &quot;Goblinwatch&quot; and it will be used as hint.</font>
evt.map[<font color="Brown">101</font>] <B><font color="Blue">=</font></B> <B><font color="Black">function</font></B>()
  <B><font color="Black">if</font></B> <B><font color="Black">not</font></B> mapvars.CastleUnlocked <B><font color="Black">and</font></B> <B><font color="Black">not</font></B> TakeItemFromParty(<font color="Brown">489</font>) <B><font color="Black">then</font></B>  <font color="Green">-- &quot;Key to Goblinwatch&quot;</font>
    <B><font color="Blue">return</font></B> Game.ShowStatusText(TXT.DoorIsLocked)
  <B><font color="Black">end</font></B>
  mapvars.CastleUnlocked <B><font color="Blue">=</font></B> <font color="Brown">true</font>
  evt.MoveToMap<B><font color="Black">{</font></B>Name <B><font color="Blue">=</font></B> <font color="Brown">&quot;D01.blv&quot;</font>, X <B><font color="Blue">=</font></B> <font color="Brown">601</font>, Y <B><font color="Blue">=</font></B> <font color="Brown">6871</font>, Z <B><font color="Blue">=</font></B> <font color="Brown">177</font>, Direction <B><font color="Blue">=</font></B> <font color="Brown">1400</font>, HouseId <B><font color="Blue">=</font></B> <font color="Brown">171</font>, Icon <B><font color="Blue">=</font></B> <font color="Brown">5</font><B><font color="Black">}</font></B>  <font color="Green">-- &quot;Goblinwatch&quot;</font>
<B><font color="Black">end</font></B>
</pre>
</td>
</tr>
</tbody>
</table>
<br>
en|You can decompile scripts of TCC or Rev4 mod by yourself.
To do so, extract all *.evt and *.str files from the same LOD archive you used to extract *.txt files.

Put them into "Decompile" folder inside the game folder, create "Scripts" subfolder in it and run this simple script:|
ru|Вы можете декомпилировать скрипты TCC или Rev4 мода самостоятельно.

Для этого извлеките все *.evt и *.str файлы из того же архива LOD что вы использовали для извлечения *. TXT файлов.

Положите их в папку "Decompile" в папку с игрой, создайте в ней подпапку "Scripts" и выполните этот простой скрипт:|
<br>
<table style="margin:6px 0;border-color:rgb(136,136,136);border-width:1px;border-collapse:collapse" border="1" bordercolor="#888888" cellpadding="5" cellspacing="0">
<tbody>
<tr>
<td>
<pre style="white-space: pre-wrap;"><b><font color="Black">for</font></b> f <b><font color="Black">in</font></b> files.<font color="Teal">find</font>(<font color="Brown">"Decompile/*.evt"</font>) <b><font color="Black">do</font></b>
  evt.Decompile(f, <font color="Brown">0</font>, <font color="Brown">"Decompile/Scripts/"</font><b><font color="Red">..</font></b>files.setext(files.name(f), <font color="Brown">".txt"</font>))<br><b><font color="Black">end</font></b>
</pre>
</td>
</tr>
</tbody>
</table>
<br>

<h3>en|Quests|ru|Задания|</h3>
en|Original MM quests were spread across multiple files and were manually programmed, which is inconvenient and error prone. My quests support has undergone a few iterations and I'm very happy with it now.|ru|Оригинальные задания MM были разбросаны по нескольким файлам и программировались вручную, это неудобно и чревато ошибками. Поддержка заданий в MMExtension прошла несколько итераций и сейчас я ею очень доволен. |<br>
<a href="https://dl.dropboxusercontent.com/u/44735333/mm/Sample%20Quests.rar">en|Here are 4 examples|ru|Здесь 4 примера|</a>.
en|They are for MM8. They will also work in MM7 if you find the NPCs they operate on. Start with <b>Quest Example Simple.lua</b>. It is contains a simple quest with two text topics. <b>Quest Example.lua</b> contains basically the same quest, but a bit more complex. It has different NPC greetings depending on quest state and conditionally shown topics, one of which lets you buy items from NPC. <b>Quest With 2 NPCs.lua</b> is an example of quest that requires going to another NPC. <b>Multilevel Quest.lua</b> is a complex tree-style dialog, yet elegant in execution. At the end of most examples there is extra information about functions used.<br>
As for MM6, it lacks NPC greetings and only has 3 dialog topics, plus two text-only topics. The first quest should work in it. |

ru|Они сделаны для MM8. В MM7 они тоже будут работать, если Вы найдёте персонажей, к которыми они применяются. Начните с <b>Quest Example Simple.lua</b>. Это простое задание с двумя дополнительными пунктами разговора. <b>Quest Example.lua</b> содержит копию того же задания, и кое-что дополнительно: приветствие NPC зависит от состояния задания, есть пункты диалога, показываемые при определённых условиях, один из которых - покупка предмета у NPC. <b>Quest With 2 NPCs.lua</b> - это пример задания, для выполнения которого надо пойти к другому NPC. <b>Multilevel Quest.lua</b> создаёт сложный древовидный диалог, но код остаётся вполне элегантным. В конце большинства примеров есть дополнительная информация об использованных функциях.<br>
Что касается MM6, в нём нет приветствий персонажей и всего 3 пункта диалога, плюс 2 исключительно текстовых пункта. Первый пример задания на нём должен работать. |
<br>
<br>

<h3>en|Localization|ru|Локализация|</h3>
en|In order to make a script localizeable you should call <b>Localize</b> function in it, passing a table with default strings. The function will return a table with localized strings. See |
ru|Чтобы сделать скрипт локализуемым, Вы должны в нём вызвать функцию <b>Localize</b>, передав ей таблицу со строками по умолчанию. Она вернёт таблицу с локализованными строками. См. | 
<a href="#LocalizeScriptExample">en|an example above|ru|предыдущий пример|</a>.<br>

en|For strings shared by multiple scripts you should use <b>LocalizeAll</b> function which works the same way, but normally you should only use the table returned by <b>Localize</b>. It automatically falls back to common localization strings if there is no script-specific one.<br>
Also note that you aren't limited to strings, localization table can contain any values, including subtables.<br>
Quests are localized automatically.|

ru|Для общих строк, используемых несколькими скриптами, используйте функцию <b>LocalizeAll</b>. Она работает так же, но Вам не потребуется возвращаемая ей таблица. Таблица, возвращаемая <b>Localize</b>, автоматически берёт отсутствующие строки из таблицы общих строк.<br>
Вообще, таблицы локализации могут содержать любые значения, а не только строки. В том числе, подтаблицы.<br>
Задания локализуются автоматически.|
<br>
<br>
en|Localization is very much automated. <b>GenerateLocalization()</b> function automatically extracts localization information from all scripts and generates localization files. It requires scripts in <b>Maps</b> and <b>Modules</b> folders not to do anything prior to calling <b>Localize</b> and/or <b>LocalizeAll</b> functions. Also, each function should be called at most once per script, otherwise strings passed in subsequent calls may get ignored.|
ru|Локализация максимально автоматизирована. Функция <b>GenerateLocalization()</b> автоматически извлекает информацию о локализации из всех скриптов и генерирует файлы локализации. Она накладывает ограничения на скрипты в папках <b>Maps</b> и <b>Modules</b>. Эти скрипты не должны ничего делать до вызова функций <b>Localize</b> и/или <b>LocalizeAll</b>. К тому же, каждую функцию они должны вызывать только 1 раз, иначе строки, переданные в последующих вызовах, могут быть проигнорированы.|
<br>
en|To generate localization files for all scripts, load any game, press Ctrl+F1, write <b>GenerateLocalization()</b> and press Ctrl+Enter. It will generate the following files in <b>Scripts\Localization</b> folder:|
ru|Чтобы сгенерировать файлы локализации для всех скриптов, загрузите любую игру, нажмите Ctrl+F1, напишите <b>GenerateLocalization()</b> и нажмите Ctrl+Enter. В папке <b>Scripts\Localization</b> будут созданы следующие файлы:|
<table style="margin:6px 0;border-color:rgb(136,136,136);border-width:1px;border-collapse:collapse" border="1" bordercolor="#888888" cellpadding="5" cellspacing="0">
<tbody>
	<td><i>&nbsp;en|File|ru|Файл|</i></td><td><i>&nbsp;en|Description|ru|Описание|</i></td>
	<tr><td>Quests.txt</td><td>en|Quests localization.|ru|Локализация заданий.|</td></tr>
	<tr><td>Common.txt</td><td>en|Strings passed to <b>LocalizeAll</b> function.|ru|Строки, переданные в функцию <b>LocalizeAll</b>.|</td></tr>
	<tr><td>Scripts.txt</td><td>en|Strings passed to <b>Localize</b> function.|ru|Строки, переданные в функцию <b>Localize</b>.|</td></tr>
</tbody>
</table>
en| These files should be edited with |ru| Для редактирования этих файлов используйте |<a href="https://sites.google.com/site/sergroj/wog/TxtEdit.rar">Txt Tables Editor</a>.<br>
en| Alternatively, you can run <b>GenerateLocalization(true)</b> to generate *.lua localization files. Choose whichever format you prefer.|
ru| Или же можно запустить команду <b>GenerateLocalization(true)</b>, чтобы сгенерировать файлы локализации *.lua. Выбирайте тот формат, который Вам удобнее.|<br>
en| To generate localization for quests only you can use <b>GenerateQuestsLocalization()</b> command.<br>
To generate localization excluding quests you can use <b>GenerateLocalization(false, false)</b> command.|
ru| Чтобы сгенерировать локализацию только для заданий, можно использовать команду <b>GenerateQuestsLocalization()</b>.<br>
Чтобы сгенерировать локализацию для всего, кроме заданий, можно использовать команду <b>GenerateLocalization(false, false)</b>.|
<br>
<br>
en| To test localization changes without restarting the game you can create a script in <b>Global</b> folder with this line:|
ru| Чтобы тестировать изменения локализации без перезапуска игры, можно создать скрит в папке <b>Global</b> со следующей строкой:|
<br>
<b>ReloadLocalization()</b><br>
en| Then you'll only need to reload a saved game to test localization changes.|
ru| После этого для для тестирования изменений локализации достаточно будет перезагрузить сохраненную игру.|
<br>
<br>

<hr>
<h2>en|Examples|ru|Примеры|</h2>

<h3>en|Controlling monsters aggression in MM6|ru|Управление агрессией монстров в MM6|</h3>
en|Put this script into Scripts\Global or Scripts\General folder. It would make archers in Free Haven friendly
and female peasants aggressive. In other places archers would be still aggressive and peasants would be still friendly.|
ru|Положите этот скрипт в папку Scripts\Global или Scripts\General. Это делает лучников в Free Haven дружественными, а крестьян - агрессивными. В других местах лучники будут по-прежнему агрессивными, а крестьяне - дружелюбными.|
<table style="margin:6px 0;border-color:rgb(136,136,136);border-width:1px;border-collapse:collapse" border="1" bordercolor="#888888" cellpadding="5" cellspacing="0">
<tbody>
<tr>
<td>
<pre style="white-space: pre-wrap;"><b><font color="Black">function</font></b> events.BeforeLoadMap() <br>  <b><font color="Black">if</font></b> Game.Map.Name <b><font color="Red">==</font></b> <font color="Brown">"outc2.odm"</font> <b><font color="Black">then</font></b> <br>    LocalMonstersTxt() <br><br>    Game.MonstersTxt[<font color="Brown">1</font>].HostileType <b><font color="Blue">=</font></b> <font color="Brown">0</font>  <font color="Green">-- ArcherA </font>
    Game.MonstersTxt[<font color="Brown">2</font>].HostileType <b><font color="Blue">=</font></b> <font color="Brown">0</font>  <font color="Green">-- ArcherB </font>
    Game.MonstersTxt[<font color="Brown">3</font>].HostileType <b><font color="Blue">=</font></b> <font color="Brown">0</font>  <font color="Green">-- ArcherC </font>
    Game.MonstersTxt[<font color="Brown">121</font>].HostileType <b><font color="Blue">=</font></b> <font color="Brown">4</font>  <font color="Green">-- PeasantF1A </font>
    Game.MonstersTxt[<font color="Brown">122</font>].HostileType <b><font color="Blue">=</font></b> <font color="Brown">4</font>  <font color="Green">-- PeasantF1B </font>
    Game.MonstersTxt[<font color="Brown">123</font>].HostileType <b><font color="Blue">=</font></b> <font color="Brown">4</font>  <font color="Green">-- PeasantF1C </font>
  <b><font color="Black">end</font></b>
<b><font color="Black">end</font></b>
</pre>
</td>
</tr>
</tbody>
</table>
en|Instead of map name check you can put any condition. For example, after player completes a quest you can make some monsters friendly or aggressive.<br>|
ru|Вместо проверки имени карты вы можете поставить любое условие. Например, после того как игрок выполнит задание, вы можете сделать некоторых монстров дружественными или агрессивными.<br>|


<h3>en|Players Skills And Spells|ru|Умения и заклинания игроков|</h3>
en|Below are some scripts demonstrating how you can work with skills and spells. You can test them by pasting the one you like into debug console.<br>|
ru|Здесь есть кое-какие скрипты, показывающие, как можно работать с умениями и заклинаниями. Скопируйте приглянувшийся скрипт в отладочную консоль, чтобы протестировать его.<br>|
<table style="margin:6px 0;border-color:rgb(136,136,136);border-width:1px;border-collapse:collapse" border="1" bordercolor="#888888" cellpadding="5" cellspacing="0">
<tbody>
<tr>
<td>
<pre style="white-space: pre-wrap;"><font color="Green">-- get all spells</font>
<b><font color="Black">for</font></b> _,pl <b><font color="Black">in</font></b> Party <b><font color="Black">do</font></b>
  <b><font color="Black">for</font></b> i <b><font color="Black">in</font></b> pl.Spells <b><font color="Black">do</font></b>
    pl.Spells[i] <b><font color="Blue">=</font></b> <font color="Brown">true</font>
  <b><font color="Black">end</font></b>
<b><font color="Black">end</font></b>

<font color="Green">-- get Expert Perception for all players</font>
<b><font color="Black">for</font></b> _,pl <b><font color="Black">in</font></b> Party <b><font color="Black">do</font></b>
  <b><font color="Blue">local</font></b> skill, mastery <b><font color="Blue">=</font></b> SplitSkill(pl.Skills[const.Skills.Perception])<br>  pl.Skills[const.Skills.Perception] <b><font color="Blue">=</font></b> JoinSkill(<font color="Teal">math</font>.<font color="Teal">max</font>(skill, <font color="Brown">4</font>), <font color="Teal">math</font>.<font color="Teal">max</font>(mastery, const.Expert))<br><b><font color="Black">end</font></b>

<font color="Green">-- get all skills at Master 12</font>
<b><font color="Black">for</font></b> _,pl <b><font color="Black">in</font></b> Party <b><font color="Black">do</font></b>
  <b><font color="Black">for</font></b> i,val <b><font color="Black">in</font></b> pl.Skills <b><font color="Black">do</font></b>
    <b><font color="Blue">local</font></b> skill, mastery <b><font color="Blue">=</font></b> SplitSkill(val)<br>    pl.Skills[i] <b><font color="Blue">=</font></b> JoinSkill(<font color="Teal">math</font>.<font color="Teal">max</font>(skill, <font color="Brown">12</font>), <font color="Teal">math</font>.<font color="Teal">max</font>(mastery, const.Master))<br>  <b><font color="Black">end</font></b>
<b><font color="Black">end</font></b>

<font color="Green">-- get all learned skills at Master 12</font>
<b><font color="Black">for</font></b> _,pl <b><font color="Black">in</font></b> Party <b><font color="Black">do</font></b>
  <b><font color="Black">for</font></b> i,val <b><font color="Black">in</font></b> pl.Skills <b><font color="Black">do</font></b>
    <b><font color="Black">if</font></b> val <b><font color="Red">~=</font></b> <font color="Brown">0</font> <b><font color="Black">then</font></b>
      <b><font color="Blue">local</font></b> skill, mastery <b><font color="Blue">=</font></b> SplitSkill(val)<br>      pl.Skills[i] <b><font color="Blue">=</font></b> JoinSkill(<font color="Teal">math</font>.<font color="Teal">max</font>(skill, <font color="Brown">12</font>), <font color="Teal">math</font>.<font color="Teal">max</font>(mastery, const.Master))<br>    <b><font color="Black">end</font></b>
  <b><font color="Black">end</font></b>
<b><font color="Black">end</font></b>

<font color="Green">-- learn all available skills at Expert (MM6)</font>
<b><font color="Black">for</font></b> _,pl <b><font color="Black">in</font></b> Party <b><font color="Black">do</font></b>
  <b><font color="Black">for</font></b> i,learn <b><font color="Black">in</font></b> Game.ClassKinds.StartingSkills[pl.Class:div(<font color="Brown">3</font>)] <b><font color="Black">do</font></b>
    <b><font color="Black">if</font></b> learn <b><font color="Red">&gt;</font></b> <font color="Brown">0</font> <b><font color="Black">then</font></b>  <font color="Green">-- can learn</font>
      <b><font color="Blue">local</font></b> skill, mastery <b><font color="Blue">=</font></b> SplitSkill(pl.Skills[i])<br>      skill <b><font color="Blue">=</font></b> <font color="Teal">math</font>.<font color="Teal">max</font>(skill, <font color="Brown">4</font>)  <font color="Green">-- learn at least level 4</font>
      mastery <b><font color="Blue">=</font></b> <font color="Teal">math</font>.<font color="Teal">max</font>(mastery, const.Expert)  <font color="Green">-- learn the mastery</font>
      pl.Skills[i] <b><font color="Blue">=</font></b> JoinSkill(skill, mastery)<br>    <b><font color="Black">end</font></b>
  <b><font color="Black">end</font></b> <br><b><font color="Black">end</font></b>

<font color="Green">-- learn all available skills at their maximum level (MM7,8)</font>
<b><font color="Blue">local</font></b> LearnLevel <b><font color="Blue">=</font></b> <b><font color="Black">{</font></b>[<font color="Brown">0</font>] <b><font color="Blue">=</font></b> <font color="Brown">0</font>, <font color="Brown">1</font>, <font color="Brown">4</font>, <font color="Brown">7</font>, <font color="Brown">12</font><b><font color="Black">}</font></b>

<b><font color="Black">for</font></b> _,pl <b><font color="Black">in</font></b> Party <b><font color="Black">do</font></b>
  <b><font color="Black">for</font></b> i,learn <b><font color="Black">in</font></b> Game.Classes.Skills[pl.Class] <b><font color="Black">do</font></b>
    <b><font color="Blue">local</font></b> skill, mastery <b><font color="Blue">=</font></b> SplitSkill(pl.Skills[i])<br>    skill <b><font color="Blue">=</font></b> <font color="Teal">math</font>.<font color="Teal">max</font>(skill, LearnLevel[learn])  <font color="Green">-- learn at least the usual needed level</font>
    mastery <b><font color="Blue">=</font></b> <font color="Teal">math</font>.<font color="Teal">max</font>(mastery, learn)  <font color="Green">-- learn the mastery</font>
    pl.Skills[i] <b><font color="Blue">=</font></b> JoinSkill(skill, mastery)<br>  <b><font color="Black">end</font></b>
<b><font color="Black">end</font></b>
</pre>
</td>
</tr>
</tbody>
</table>

<h3>en|Other Examples|ru|Еще примеры|</h3>
<table style="margin:6px 0;border-color:rgb(136,136,136);border-width:1px;border-collapse:collapse" border="1" bordercolor="#888888" cellpadding="5" cellspacing="0">
<tbody>
<tr>
<td>
<pre style="white-space: pre-wrap;"><font color="Green">-- summon monster (Peasant)</font>
<b><font color="Black">function</font></b> events.LoadMap()<br>  <b><font color="Blue">local</font></b> mon <b><font color="Blue">=</font></b> SummonMonster(<font color="Brown">151</font>, Party.X, Party.Y, Party.Z, <font color="Brown">true</font>)<br>  mon.NPC_ID <b><font color="Blue">=</font></b> <font color="Brown">52</font>
  mon.Hostile <b><font color="Blue">=</font></b> <font color="Brown">false</font>
<b><font color="Black">end</font></b>


<font color="Green">-- see global event number (copy to console to quickly test what event is triggered by a dialog item)</font>
<font color="Green">-- on:</font>
<b><font color="Black">function</font></b> events.EvtGlobal(evt)<br>  Message(evt)<br><b><font color="Black">end</font></b>
<font color="Green">-- off:</font>
events.EvtGlobal.clear()
</pre>
</td>
</tr>
</tbody>
</table>

<br>
<hr>
<h2>en|Reference Manual|ru|Справочник|</h2>

en|<a href="https://sites.google.com/site/sergroj/mm/mmextension/reference">Reference Manual</a> is under construction, but usable.|
ru|<a href="https://sites.google.com/site/sergroj/mm/mmextension/reference">Справочник</a> находится на стадии разработки, но пригоден к использованию.|
<br>
